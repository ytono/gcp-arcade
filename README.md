このドキュメントは、Keycloakを使ってアプリケーションやサービスをセキュアにするための包括的なガイドです。Keycloakは、OAuth2、OpenID Connect、SAMLに準拠したサーバーであり、これらのプロトコルをサポートする技術スタックを使用している限り、あらゆるアプリケーションやサービスを保護できます。

ドキュメントは、以下の主要なセクションに分かれています。

**1. アプリケーションとサービスのセキュリティ確保の計画:**
* Keycloakがサポートするセキュリティプロトコルの概要。
* アプリケーションのセキュリティを確保するための基本的な手順（クライアントの登録、OpenID ConnectまたはSAMLプロトコルの有効化など）。
* さまざまなプログラミング言語やフレームワークを使用してアプリケーションを保護する方法の例を提供するKeycloakクイックスタートリポジトリの紹介。
* OpenID ConnectとSAMLプロトコルの両方について、信頼できるよく知られているクライアントサイドの実装に関する推奨事項。
* このガイドで使用される用語（クライアント、アプリケーション、クライアントアダプター、サービアカウントなど）の説明。

**2. OpenID Connectを使用してアプリケーションとサービスを保護する:**
* アプリケーションとサービスがユーザーの認証と承認のために使用できる、Keycloakが公開するさまざまなエンドポイントの説明（ウェルノウン構成エンドポイント、承認エンドポイント、トークンエンドポイントなど）。
* Keycloakでサポートされているさまざまなグラントタイプ（認可コード、インプリシット、リソースオーナーパスワードクレデンシャル、クライアントクレデンシャル、デバイス認可グラント、クライアント開始バックチャネル認証グラント）の説明。
* Keycloakに固有のエラーと、クライアントアプリケーションがそれらを処理する方法の説明。
* さまざまなプログラミング言語やプラットフォームのアプリケーションを保護するためのKeycloakアダプター（Keycloak JavaScriptアダプター、Keycloak Node.jsアダプターなど）の使い方。
* DockerレジストリをKeycloakを認証サーバーとして使用するように構成する方法の説明。
* Keycloakクライアント登録サービスを使用してクライアントを登録する方法の説明。
* トークン交換を使用して、あるトークンを別のトークンと交換する方法の説明。
* Keycloakを使用してアプリケーションを保護する際の推奨事項（アクセストークンの検証、リダイレクトURIなど）。

**3. SAMLを使用してアプリケーションとサービスを保護する:**
* さまざまなJavaアプリケーション用のKeycloakアダプターの概要。
* すべてのSAMLクライアントアダプターに共通の一般的なアダプター構成の説明。
* JBoss EAP/WildFlyアダプターのインストールと構成方法の説明。
* アイデンティティプロバイダーへの登録方法の説明。
* Webアプリケーションからのログアウト方法の説明。
* アサーション属性を取得する方法の説明。
* エラー処理とトラブルシューティングに関する情報。
* マルチテナンシー（単一のターゲットアプリケーションを複数のKeycloakレルムで保護する方法）の説明。
* 古いバージョンからの移行に関する情報。
* mod_auth_mellon Apache HTTPDモジュールを使用して、SAMLでWebアプリケーションを保護する方法の説明。

**4. DockerレジストリをKeycloakを認証サーバーとして使用するように構成する:**
* Dockerレジストリの構成方法の概要。
* Dockerレジストリ構成ファイルのインストール方法の説明。
* Dockerレジストリの環境変数オーバーライドインストール方法の説明。
* Docker Compose YAMLファイルを使用して、Keycloakサーバーと対話するDockerレジストリを構成する方法の説明。

**5. クライアント登録サービスを使用する:**
* Keycloakクライアント登録サービスの概要と使用方法の説明。
* サポートされているさまざまなプロバイダー（デフォルト、インストール、openid-connect、saml2-entity-descriptor）の説明。
* CURLとJavaクライアント登録APIを使用してクライアントを登録する例。
* クライアント登録ポリシーとその使用方法の説明。

**6. CLIによるクライアント登録の自動化:**
* Keycloakクライアント登録CLIの概要と使用方法の説明。
* クライアント登録CLIのインストール方法の説明。
* 認証、クライアント構成の作成、取得、変更、削除など、クライアント登録CLIの使用方法の説明。
* 代替構成での作業方法の説明。
* 初期アクセストークンと登録アクセストークンに関する情報。
* トラブルシューティングに関する情報。

**7. トークン交換を使用する:**
* Keycloakでのトークン交換の仕組みの説明。
* トークン交換要求のフォームパラメーターと応答の説明。
* 内部トークンと内部トークン、内部トークンと外部トークン、外部トークンと内部トークンのさまざまなトークン交換シナリオのセットアップと使用例。
* なりすましとその使用方法の説明。
* 直接なりすましとその危険性に関する情報。
* サービスアカウントを使用した許可モデルの拡張方法の説明。
* トークン交換に関連する脆弱性に関する情報。
